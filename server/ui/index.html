<html>
<head>
  <title>Express HTML</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script type="text/javascript">
    $( document ).ready(function() {
      prettyPrint('inputTextArea');
    });

    function prettyPrint(areaId) {
      var ugly = document.getElementById(areaId).value;
      var obj = JSON.parse(ugly);
      var pretty = JSON.stringify(obj, undefined, 4);
      document.getElementById(areaId).value = pretty;
    }

    function sendRequest(areaId) {
      var payload = JSON.stringify(JSON.parse(document.getElementById(areaId).value));
      console.log("Payload: " + payload)
      $.ajax({
        url: "./analytics",
        type: "POST",
        dataType: "json",
        data: payload,
        contentType: "application/json"
      }).done(function( postData ) {
          var modelId = postData.modelId;
          console.log("ModelId: " + modelId)
          console.log("Post response: " + JSON.stringify(postData));

          $(window).delay(5000).queue(function() {
            $.get( "./analytics/" + modelId)
              .done(function( getData ) {
                console.log("Get response: " + JSON.stringify(getData));
                var pretty = JSON.stringify(getData, undefined, 4);
                $('#responseData').html(pretty);
              });

            $(this).dequeue();
          });
        });
    }
  </script>
  <style>
    html{
    font-size: 1em;
}

.ib-parent{             /* ib -> inline-block */
    font-size: 0;
}

.ib-child{
    display: inline-block;
    font-size: 1rem;
}
  </style>
</head>
<body>
  <div style="margin:10px;">
    <nav class="navbar navbar-inverse navbar-static-top">
  <div class="container">
    <a class="navbar-brand" href="/">UMEC Healthcare Workforce API</a>
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/">Home</a>
      </li>
      <li>
        <a href="/about">About</a>
      </li>
      <li>
        <a href="/sitemap">Sitemap</a>
      </li>
    </ul>
  </div>
</nav>
    <div class="jumbotron"  style="padding:20px;">
      <h2>Upload Data Source</h2>
      <p>
        <form action='./source' method='post' enctype='multipart/form-data'>
          <input type='file' name='filetoupload'><br/>
          <input class="btn btn-primary btn-lg" type='submit'/>
        </form>
      </p>
    </div>
    <div class="jumbotron"  style="padding:20px;">
      <h2>Download Data Source</h2>
      <p>
        (Populate here)
      </p>
    </div>
    <div class="jumbotron ib-parent" style="padding:20px;width:100%;vertical-align:top;">
      <h2>Model Request</h2>
      <div class="ib-child" style="width:50%;">
        <textarea id="inputTextArea" style="width:100%;height:200px;" cols=50 rows=10>{"params": {"request_type": "provider_profile", "value": "Psych"}}</textarea>
        <button style="margin-top:5px;" onclick="sendRequest('inputTextArea')">Request</button>
      </div>
      <div class="ib-child" style="width:50%;vertical-align:top;">
        <pre id="responseData" style="width:100%;height:200px;">Response will appear here</pre>
      </div>
    </div>
  </div>
</body>
</html>